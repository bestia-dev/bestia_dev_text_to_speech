<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="bestia_dev_text_to_speech"><title>bestia_dev_text_to_speech - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c4dbdcde0fbd8430.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-db279b6232be9c13.css"><link rel="stylesheet" disabled href="../static.files/dark-cf923f49f397b216.css"><link rel="stylesheet" disabled href="../static.files/ayu-be46fdc453a55015.css"><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-98a684e84ae5b08b.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../bestia_dev_text_to_speech/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../bestia_dev_text_to_speech/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate bestia_dev_text_to_speech</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.1.44</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">bestia_dev_text_to_speech</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/bestia_dev_text_to_speech/lib.rs.html#4-239">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="bestia_dev_text_to_speech"><a href="#bestia_dev_text_to_speech">bestia_dev_text_to_speech</a></h2>
<p><strong>Text-to-speech CLI using Google api</strong><br />
<em><strong>version: 0.1.44 date: 2023-05-31 author: <a href="">bestia.dev</a> repository: <a href="https://github.com/bestia-dev/bestia_dev_text_to_speech">Github</a></strong></em></p>
<p><a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://img.shields.io/badge/Lines_in_Rust-98-green.svg" alt="Lines in Rust code" /></a>
<a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://img.shields.io/badge/Lines_in_Doc_comments-161-blue.svg" alt="Lines in Doc comments" /></a>
<a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://img.shields.io/badge/Lines_in_comments-30-purple.svg" alt="Lines in Comments" /></a>
<a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://img.shields.io/badge/Lines_in_examples-15-yellow.svg" alt="Lines in examples" /></a>
<a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://img.shields.io/badge/Lines_in_tests-20-orange.svg" alt="Lines in tests" /></a></p>
<p><a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" /></a> <a href="https://github.com/bestia-dev/bestia_dev_text_to_speech/"><img src="https://github.com/bestia-dev/bestia_dev_text_to_speech/workflows/RustAction/badge.svg" alt="Rust" /></a> <img src="https://bestia.dev/webpage_hit_counter/get_svg_image/791106357.svg" alt="Hits" /></p>
<p>Hashtags: #rustlang #tutorial<br />
My projects on Github are more like a tutorial than a finished product: <a href="https://github.com/bestia-dev/tutorials_rust_wasm">bestia-dev tutorials</a>.</p>
<h3 id="motivation"><a href="#motivation">Motivation</a></h3>
<p>After creating some interesting projects and tutorials for rust development and sharing them on Github, I wanted to create youtube videos for them. Sometimes it is easier to follow a video tutorial then to read kilometers of text tutorials.<br />
The easy part is capturing the screen with <code>OBS Studio</code>. Everything visual is going on on the screen. It is a computer project, after all. The hard part is the spoken text.<br />
It is impossible to just naturally talk about what I am doing while recording the screen. Maybe somebody has the talent of fast and focused speech. I don’t. Maybe because I am not a native English speaker. I am not at home as a speaker.<br />
And my voice sound terrible and the accent and intonation is just not what english should sound like.
But I can write pretty well. It takes ages and it is very slow, but I am happy with the result.<br />
I am a programmer and for me every problem has a software solution. This is the story when you have a hammer, everything looks like a nail.</p>
<p>Finally I decided to use a text-to-speech approach.</p>
<p>I have a (very cheap) google account that I use for a VM that hosts my domain and my website. Google is very kind to offer text-to-speech api for free for 1 million characters. I hope this could be the right solution for me. It sounds very natural. It uses some magic neural network and it sounds definitely better then me.<br />
But it is only an api. There is no prepared application or website that I can use.</p>
<p>What is more fun, than write an application in Rust for my problem?</p>
<h3 id="rust-cli-from-template"><a href="#rust-cli-from-template">Rust CLI from template</a></h3>
<p>The easiest application to write in Rust is a CLI in Linux. And honestly I don’t need more. I will have a text file as input and an mp3 file as output. Perfect for a CLI application.
For the first time I will develope a new Rust application entirely inside a docker container using my project <a href="https://github.com/bestia-dev/docker_rust_development">https://github.com/bestia-dev/docker_rust_development</a>. I want to have my rust development sandboxed. I am scared to allow tools and crates from unknown developers to have full access to my underlying system: Win10+WSL2 (<a href="https://github.com/bestia-dev/win10_wsl2_debian11">https://github.com/bestia-dev/win10_wsl2_debian11</a>).<br />
In <code>WSL2 terminal</code>:</p>
<div class="example-wrap"><pre class="language-bash"><code>cd rustprojects/docker_rust_development/
# my development pod/container is already created. I just need to restart it after reboot
sh rust_dev_pod_after_reboot.sh
</code></pre></div>
<p>In VSCode: <code>F1</code>, type <code>ssh</code>, choose <code>Remote-SSH:Connect to Host...</code>, choose <code>rust_dev_pod</code>, type the passphrase for the SSH key. We have opened a new VSCode window that works inside the Rust development container.</p>
<p>I will also use for the first time my template for Rust CLI development: <a href="https://github.com/bestia-dev/bestia_dev_cargo_auto_new_cli">https://github.com/bestia-dev/bestia_dev_cargo_auto_new_cli</a>. It separates a lib and a bin, so the project could be used as a library for other projects. It has prepared automation tasks for building the project and some samples how to use tests and examples.<br />
In <code>VSCode terminal</code>:</p>
<div class="example-wrap"><pre class="language-bash"><code># save the passphrase to communicate with Github over SSH
eval $(ssh-agent)
ssh-add /home/rustdevuser/.ssh/github_com_ssh_1
# clone the template
mkdir ~/rustprojects
cd ~/rustprojects
git clone git@github.com:bestia-dev/bestia_dev_cargo_auto_new_cli.git
# rename the template to the project name
mv bestia_dev_cargo_auto_new_cli bestia_dev_text_to_speech
cd bestia_dev_text_to_speech
# remove the git files, because now it is a new project
rm -r -f .git
rm -r docs
mv src/bin/bestia_dev_cargo_auto_new_cli.rs src/bin/bestia_dev_text_to_speech.rs
# open a new VSCode window inside the new project
code .

</code></pre></div><h3 id="template-renaming"><a href="#template-renaming">Template Renaming</a></h3>
<ol>
<li>In Cargo.toml change the name and the description and some other info.</li>
<li>In <code>VSCode terminal</code> type <code>cargo auto release</code> to copy the title and description to README.md and lib.rs.</li>
<li>Replace the title in other files. In VSCode Ctrl+Shift+H to open the replace in all files. Search for <code>bestia_dev_cargo_auto_new_cli</code>, replace with <code>bestia_dev_text_to_speech</code>. When you click on the result list item, you can see what you are actually replacing. A small icon at the right end of the item is <code>Replace (Ctrl+Shift+1)</code>.</li>
</ol>
<p>For now I will leave the functions that are used in examples and tests. I will modify them, when the new functions will be ready.</p>
<h3 id="github-push-new-project"><a href="#github-push-new-project">Github push new project</a></h3>
<p>First in VSCode open Source Control (Ctrl+Shift+G), click <code>Initialize Repository</code>, type the message <code>init</code> and Ctrl+Enter.
On the Github website create a new project <a href="https://github.com/new">https://github.com/new</a>, copy the name and the description from Cargo.toml. You don’t need other files magically created. Save the new project. Github is very kind to give us some Git commands we can use. Now in <code>VSCode terminal</code> copy the commands from Github (second group):</p>
<div class="example-wrap"><pre class="language-bash"><code>git remote add origin git@github.com:bestia-dev/bestia_dev_text_to_speech.git
git branch -M main
git push -u origin main
</code></pre></div><h3 id="readmemd"><a href="#readmemd">README.md</a></h3>
<p>Open <code>README.md</code> and delete the text you don’t need. Don’t delete the markers for the automation. You can see the markdown preview with (Ctrl+k, v). Save the changes.
Commit the changes and push in <code>VSCode terminal</code>: <code>cargo auto commit_and_push &quot;readme cleaned&quot;</code>
Commit and push often to reduce the risk of loosing your work.</p>
<h3 id="google-api-text-to-speech"><a href="#google-api-text-to-speech">google api text-to-speech</a></h3>
<p>In my googlecloud account I enabled the text-to-speech api: <a href="https://console.cloud.google.com/apis/api/texttospeech.googleapis.com">https://console.cloud.google.com/apis/api/texttospeech.googleapis.com</a><br />
Service name <code>texttospeech.googleapis.com</code><br />
I need some credentials to access the api: <a href="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials</a>
Click <code>+Create credentials</code>, <code>API key</code>, then <code>edit</code>, rename to <code>API text-to-speech</code>, restrict to only <code>Cloud Text-to-Speech API</code>.
Use this key in your application by passing it with the <code>?key=API_KEY</code> parameter for every request.
Save this api key in env variable:</p>
<div class="example-wrap"><pre class="language-bash"><code># put a space before the command to disable bash history
 export bestia_dev_text_to_speech_api_key=YOUR_API_KEY
env
echo $bestia_dev_text_to_speech_api_key
# finally to delete the env variable after use
unset bestia_dev_text_to_speech_api_key
</code></pre></div>
<p>The simplest example from google:</p>
<div class="example-wrap"><pre class="language-bash"><code>curl -X POST \
-H &quot;Content-Type: application/json; charset=utf-8&quot; \
-d @sample_files/request.json \
&quot;https://texttospeech.googleapis.com/v1/text:synthesize?key=$bestia_dev_text_to_speech_api_key&quot;
</code></pre></div>
<p>Because of https only the domain part of the url <code>texttospeech.googleapis.com</code> is visible on the wire. The rest of the url <code>/v1/text:synthesize?key=$bestia_dev_text_to_speech_api_key</code> is encrypted. So it looks that the api-key is secure. They are encrypted on the wire (in transport) but if either end (user or server) logs the URL to a plain text file and does not sanitize credentials… now that’s a different conversation. Browsers can save the entire url in history, but I am not using a browser.</p>
<h3 id="https-client"><a href="#https-client">https client</a></h3>
<p>Among different crates for https client: curl-rust, hyper, reqwest, Isahc, Surf and ureq,<br />
I choose ureq. It is minimal.</p>
<h3 id="build-with-cargo-auto"><a href="#build-with-cargo-auto">Build with cargo auto</a></h3>
<p>All needed automation tasks to build and manage the project are centralized in the directory <code>automation_tasks_rs</code>. This is a simple Rust project and it is easy to modify the tasks in your preferred language. The classic tasks are build, release, doc and commit_and_push. But you can add any task you need to repeat and is important for the managing of the project.<br />
Use <code>cargo auto</code> to list the possible tasks. The command has bash-completion for easy writing command with just few keys.</p>
<h3 id="the-result-is-mp3-file"><a href="#the-result-is-mp3-file">The result is mp3 file</a></h3>
<p>In VSCode right click on the file <code>speech.mp3</code> and choose <code>Download</code> to transfer the file over SSH to the local system.</p>
<h3 id="cargo-crev-reviews-and-advisory"><a href="#cargo-crev-reviews-and-advisory">cargo crev reviews and advisory</a></h3>
<p>We live in times of danger with <a href="https://en.wikipedia.org/wiki/Supply_chain_attack">supply chain attacks</a>.</p>
<p>It is recommended to always use <a href="https://github.com/crev-dev/cargo-crev">cargo-crev</a> to verify the trustworthiness of each of your dependencies.</p>
<p>Please, spread this info.</p>
<p>You can also read crev reviews quickly on the web:</p>
<p><a href="https://web.crev.dev/rust-reviews/crates/">https://web.crev.dev/rust-reviews/crates/</a></p>
<h3 id="open-source-and-free-as-a-beer"><a href="#open-source-and-free-as-a-beer">Open-source and free as a beer</a></h3>
<p>My open-source projects are free as a beer (MIT license).<br />
I just love programming.<br />
But I need also to drink. If you find my projects and tutorials helpful, please buy me a beer by donating to my <a href="https://paypal.me/LucianoBestia">PayPal</a>.<br />
You know the price of a beer in your local bar ;-)<br />
So I can drink a free beer for your health :-)<br />
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/">Nazdravlje!</a> 🍻</p>
<p><a href="https://bestia.dev">//bestia.dev</a><br />
<a href="https://github.com/bestia-dev">//github.com/bestia-dev</a><br />
<a href="https://bestiadev.substack.com">//bestiadev.substack.com</a><br />
<a href="https://youtube.com/@bestia-dev-tutorials">//youtube.com/@bestia-dev-tutorials</a></p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="utils_mod/index.html" title="mod bestia_dev_text_to_speech::utils_mod">utils_mod</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Just an example how to create and call a module in a separate file.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.format_hello_phrase.html" title="fn bestia_dev_text_to_speech::format_hello_phrase">format_hello_phrase</a></div><div class="desc docblock-short">format the hello phrase</div></li><li><div class="item-name"><a class="fn" href="fn.format_upper_hello_phrase.html" title="fn bestia_dev_text_to_speech::format_upper_hello_phrase">format_upper_hello_phrase</a></div><div class="desc docblock-short">format the hello phrase with uppercase name</div></li><li><div class="item-name"><a class="fn" href="fn.post_text_to_speech.html" title="fn bestia_dev_text_to_speech::post_text_to_speech">post_text_to_speech</a></div><div class="desc docblock-short">post to google cloud the request for text-to-speech and return a byte[]</div></li><li><div class="item-name"><a class="fn" href="fn.prepare_request_json.html" title="fn bestia_dev_text_to_speech::prepare_request_json">prepare_request_json</a></div><div class="desc docblock-short">format the request json from the text file</div></li></ul></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="bestia_dev_text_to_speech" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0 (84c898d65 2023-04-16)" data-search-js="search-8a59a8356673ec1f.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>